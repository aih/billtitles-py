:toc: auto

:imagesdir: ./docs/images

# Bill Title API

## Overview

This repository provides an `http` service to get bills, titles and bills related by title. It is built on the self-documenting FastAPI in Python.

## Usage

Install using Docker (see below)

Or:

* Install `git-lfs` to download the sqlite3 database that goes with this API. (https://git-lfs.github.com/).
* Clone this repository with `git clone https://github.com/aih/billtitles-py.git`
* Install Python > 3.7 (preferably with pyenv)
* Install dependencies, including FastAPI and the uvicorn server (pip install -r requirements.txt)
* Use Git lfs to download the billtitles.db file (~ 120MB) into the top level directory of the repository
* Run the server with `uvicorn billtitles.main:app --reload`

This will provide an API to query for bills and titles; query similar bills by bill number; (soon) to query similar bills by title; and to create, update, and delete bills and titles.

NOTE: The bill-to-bill data is currently incomplete. Some sample bills are shown below.

## API

The API is self-documenting, thanks to FastAPI. It can be viewed and tested at `http://localhost:8000/docs`.

image::api-docs.png[alt=View API documentation,width=640,height=480]

The api includes paths to get bills, titles, and bills related by title:

`/bills/related/{billnumber}`

image::bill-to-bill-query.png[alt=Get related bills, width=1040,height=280]

`/bills/{billnumber}`

image::bill-query.png[alt=Get bill by billnumber,width=1040,height=280]

`/titles/?title={title name}`

image::title-query.png[alt=Get title by name,width=1040,height=280]

`/titles/{title_id}`

image::title-id-query.png[alt=Get title by id,width=1040,height=280]

## Docker

A docker image is provided at `arihersh/billtitles` on Dockerhub. To run it, install Docker, and run:

`docker run -d -t -i -p 8000:8000 arihersh/billtitles`

This will expose the API on your local port `8000`. To expose another local port (e.g., `2222`), instead run `docker run -d -t -i -p 2222:8000 arihersh/billtitles`.

This will install and run the container (about 600Mb) as a daemon.

NOTE: The data in the Docker image is not complete, especially for related bills. The title data should be up-to-date as of the commit of this README. However, it is not meant to be used in production as-is. **MacOs users** the port forwarding for Docker does not work the same on MacOs to forward to a host port. As of this writing I could not figure out how to get it to work, meaning that the image is currently useable on MacOs only as a service to other Docker containers.

## See Also

See also the `github.com/aih/bills` and `github.com/aih/billtitles` repositories in Go.

The `github.com/aih/bills` repository provides a Go module to process bills that were downloaded using the unitedstates/congress scrapers. The `github.com/aih/billtitles` repository is another Go module that converts the json output from `bills` into sqlite3. It also provides a (crude) Go API to query for bills and titles.

## License

This repository is licensed under the [MIT license](LICENSE).
